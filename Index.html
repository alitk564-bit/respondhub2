<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Response Helper</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin="anonymous" src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js" crossorigin="anonymous"></script>
    
    <!-- SheetJS for Excel Parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.firebaseModules = {
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken,
            getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query
        };
    </script>

    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .toast-enter {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: transparent;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        
        // Access Firebase modules from window
        const { 
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken,
            getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query
        } = window.firebaseModules;

        // --- ICONS ---
        const Icons = {
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            File: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Cloud: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        };

        // Firebase Configuration
        const firebaseConfig = JSON.parse(window.__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = window.__app_id || 'default-app-id';

        const App = () => {
            const [user, setUser] = useState(null);
            const [data, setData] = useState([]);
            const [categories, setCategories] = useState(["All"]);
            const [searchTerm, setSearchTerm] = useState("");
            const [activeCategory, setActiveCategory] = useState("All");
            const [toast, setToast] = useState({ show: false, message: "" });
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formEntry, setFormEntry] = useState({ scenario: "", message: "", category: "" });
            const [isLoading, setIsLoading] = useState(true);
            
            const fileInputRef = useRef(null);
            const searchInputRef = useRef(null);

            // Auth Effect
            useEffect(() => {
                const initAuth = async () => {
                    if (window.__initial_auth_token) {
                        await signInWithCustomToken(auth, window.__initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                });
                return () => unsubscribe();
            }, []);

            // Data Sync Effect
            useEffect(() => {
                if (!user) return;

                const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'data'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const fetchedData = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    // Sort locally by added time if available, or just by scenario name
                    fetchedData.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                    
                    setData(fetchedData);
                    setIsLoading(false);
                }, (error) => {
                    console.error("Error fetching data:", error);
                    setIsLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            // Update categories
            useEffect(() => {
                const cats = ["All", ...new Set(data.map(i => i.category).filter(Boolean))].sort();
                setCategories(cats);
            }, [data]);

            const getCategoryColor = (category) => {
                if (category === "All") return "slate";
                const colors = [
                    "red", "orange", "amber", "yellow", "lime", "green", 
                    "emerald", "teal", "cyan", "sky", "blue", "indigo", 
                    "violet", "purple", "fuchsia", "pink", "rose"
                ];
                let hash = 0;
                for (let i = 0; i < category.length; i++) {
                    hash = category.charCodeAt(i) + ((hash << 5) - hash);
                }
                return colors[Math.abs(hash) % colors.length];
            };

            const handleFileUpload = (e) => {
                if (!user) return;
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary' });
                        let importedCount = 0;

                        // Process all sheets
                        for (const sheetName of wb.SheetNames) {
                            const ws = wb.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(ws);
                            
                            for (const row of jsonData) {
                                const keys = Object.keys(row);
                                const scenarioKey = keys.find(k => /scenario|question|title|topic/i.test(k)) || keys[0];
                                const messageKey = keys.find(k => /message|answer|response|body/i.test(k)) || keys[1];
                                
                                if (row[scenarioKey] && row[messageKey]) {
                                    await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'data'), {
                                        scenario: String(row[scenarioKey]).trim(),
                                        message: String(row[messageKey]).trim(),
                                        category: sheetName,
                                        createdAt: Date.now()
                                    });
                                    importedCount++;
                                }
                            }
                        }

                        if (importedCount > 0) {
                            showToast(`Successfully imported ${importedCount} entries to cloud`);
                        } else {
                            showToast("No valid entries found in file", "error");
                        }
                    } catch (error) {
                        console.error(error);
                        showToast("Error parsing or uploading file");
                    }
                    e.target.value = null;
                };
                reader.readAsBinaryString(file);
            };

            const handleFormSubmit = async (e) => {
                e.preventDefault();
                if (!user) return;
                if (!formEntry.scenario || !formEntry.message || !formEntry.category) {
                    showToast("Please fill all fields");
                    return;
                }

                try {
                    if (editingId) {
                        const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'data', editingId);
                        await updateDoc(docRef, { ...formEntry });
                        showToast("Entry updated");
                    } else {
                        await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'data'), {
                            ...formEntry,
                            createdAt: Date.now()
                        });
                        showToast("New response saved to cloud");
                    }
                    resetForm();
                } catch (error) {
                    console.error("Error saving:", error);
                    showToast("Error saving data");
                }
            };

            const resetForm = () => {
                setFormEntry({ scenario: "", message: "", category: "" });
                setEditingId(null);
                setShowForm(false);
            };

            const startEdit = (item, e) => {
                e.stopPropagation();
                setEditingId(item.id);
                setFormEntry({
                    scenario: item.scenario,
                    message: item.message,
                    category: item.category
                });
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const deleteEntry = async (id, e) => {
                e.stopPropagation();
                if (!user) return;
                if(confirm("Are you sure you want to delete this response?")) {
                    try {
                        await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'data', id));
                        showToast("Entry deleted from cloud");
                    } catch (error) {
                        console.error("Delete error:", error);
                        showToast("Failed to delete");
                    }
                }
            };

            const clearAllData = async () => {
                if (!user) return;
                if(confirm("DANGER: This will delete ALL cloud data. Are you sure?")) {
                    try {
                        // Deleting one by one as per client-side capability
                        // Ideally use batching but simple loop is fine for this scale
                        for (const item of data) {
                            await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'data', item.id));
                        }
                        showToast("Library cleared");
                    } catch (error) {
                        showToast("Error clearing library");
                    }
                }
            };

            const handleCopy = (text) => {
                if (editingId) return;
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast("Copied to clipboard!");
                } catch (err) {
                    showToast("Copy failed");
                } finally {
                    document.body.removeChild(textArea);
                }
            };

            const showToast = (msg) => {
                setToast({ show: true, message: msg });
                setTimeout(() => setToast({ show: false, message: "" }), 3000);
            };

            const filteredData = useMemo(() => {
                return data.filter(item => {
                    const matchesSearch = 
                        item.scenario.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        item.message.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        item.category.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesCategory = activeCategory === "All" || item.category === activeCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [data, searchTerm, activeCategory]);

            if (!user) {
                return <div className="min-h-screen flex items-center justify-center text-slate-500">Connecting to cloud...</div>;
            }

            return (
                <div className="min-h-screen flex flex-col bg-slate-50 text-slate-800 pb-10 font-sans">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm backdrop-blur-md bg-white/90">
                        <div className="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-indigo-600 text-white p-2 rounded-lg shadow-indigo-200 shadow-md">
                                    <Icons.File />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold text-slate-900 tracking-tight leading-none">Agent Helper</h1>
                                    <p className="text-[10px] text-slate-500 font-medium uppercase tracking-wider">Knowledge Base</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2">
                                {/* Cloud Status Indicator */}
                                <div className="hidden sm:flex items-center gap-1.5 px-3 py-1.5 bg-emerald-50 text-emerald-600 rounded-full border border-emerald-100 text-xs font-semibold mr-2">
                                    <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                                    Cloud Sync Active
                                </div>

                                <div className="h-6 w-px bg-slate-200 mx-1 hidden sm:block"></div>

                                <button 
                                    onClick={() => { resetForm(); setShowForm(!showForm); }}
                                    className={`flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold transition-all shadow-sm ${
                                        showForm && !editingId 
                                        ? 'bg-slate-100 text-slate-600 ring-2 ring-slate-200' 
                                        : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md hover:-translate-y-0.5'
                                    }`}
                                >
                                    <Icons.Plus /> <span className="hidden sm:inline">Add New</span>
                                </button>
                                
                                <button 
                                    onClick={() => fileInputRef.current.click()} 
                                    className="flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-50 hover:text-indigo-600 hover:border-indigo-200 transition-all shadow-sm"
                                    title="Import Excel (.xlsx)"
                                >
                                    <Icons.Upload /> <span className="hidden sm:inline">Import</span>
                                </button>
                                <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".xlsx, .xls" className="hidden" />
                                
                                {data.length > 0 && (
                                    <button onClick={clearAllData} className="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors ml-1" title="Clear Library">
                                        <Icons.Trash />
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-5xl mx-auto w-full px-4 py-8 flex flex-col gap-6">
                        
                        {/* Edit/Add Form */}
                        {showForm && (
                            <div className="bg-white border border-slate-200 rounded-2xl p-6 shadow-xl shadow-slate-200/50 animate-in fade-in slide-in-from-top-4 duration-300">
                                <div className="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                                    <div className="flex items-center gap-2 text-indigo-600">
                                        {editingId ? <Icons.Edit /> : <Icons.Plus />}
                                        <h2 className="font-bold text-slate-800 uppercase tracking-wide text-sm">
                                            {editingId ? "Edit Scenario" : "Add New Scenario"}
                                        </h2>
                                    </div>
                                    <button onClick={resetForm} className="text-slate-400 hover:text-slate-600 p-1 hover:bg-slate-100 rounded-full transition-colors"><Icons.X /></button>
                                </div>
                                <form onSubmit={handleFormSubmit} className="grid grid-cols-1 sm:grid-cols-2 gap-5">
                                    <div className="flex flex-col gap-1.5">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Category</label>
                                        <input 
                                            list="category-suggestions"
                                            className="bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all"
                                            placeholder="e.g. Policies, Greetings..."
                                            value={formEntry.category}
                                            onChange={e => setFormEntry({...formEntry, category: e.target.value})}
                                        />
                                        <datalist id="category-suggestions">
                                            {categories.filter(c => c !== "All").map(c => <option key={c} value={c} />)}
                                        </datalist>
                                    </div>
                                    <div className="flex flex-col gap-1.5">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Scenario Title</label>
                                        <input 
                                            className="bg-slate-50 border border-slate-200 rounded-lg p-2.5 text-sm focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all"
                                            placeholder="e.g. Refund Request Denial"
                                            value={formEntry.scenario}
                                            onChange={e => setFormEntry({...formEntry, scenario: e.target.value})}
                                        />
                                    </div>
                                    <div className="flex flex-col gap-1.5 sm:col-span-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Response Message</label>
                                        <textarea 
                                            rows="6"
                                            className="bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none w-full font-mono text-slate-600 leading-relaxed resize-y"
                                            placeholder="Type or paste the standard response here..."
                                            value={formEntry.message}
                                            onChange={e => setFormEntry({...formEntry, message: e.target.value})}
                                        />
                                    </div>
                                    <div className="sm:col-span-2 flex justify-end gap-3 pt-2">
                                        <button type="button" onClick={resetForm} className="px-5 py-2.5 rounded-lg font-bold text-sm text-slate-500 hover:bg-slate-100 hover:text-slate-700 transition-colors">
                                            Cancel
                                        </button>
                                        <button type="submit" className="bg-indigo-600 text-white px-6 py-2.5 rounded-lg font-bold text-sm hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transform hover:-translate-y-0.5">
                                            {editingId ? "Update Entry" : "Save to Cloud"}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {/* Search & Filters */}
                        <div className="flex flex-col gap-4">
                            <div className="relative group">
                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                                    <Icons.Search />
                                </div>
                                <input
                                    ref={searchInputRef}
                                    type="text"
                                    className="block w-full pl-11 pr-10 py-4 bg-white border border-slate-200 rounded-xl text-lg outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 transition-all shadow-sm placeholder:text-slate-300"
                                    placeholder="Search scenarios, messages, or tags..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                                {searchTerm && (
                                    <button 
                                        onClick={() => { setSearchTerm(''); searchInputRef.current.focus(); }}
                                        className="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-300 hover:text-slate-500 cursor-pointer"
                                    >
                                        <Icons.X />
                                    </button>
                                )}
                            </div>

                            {/* Category Pills */}
                            <div className="flex flex-wrap gap-2 scrollbar-hide pb-2">
                                {categories.map(cat => {
                                    const color = getCategoryColor(cat);
                                    const isActive = activeCategory === cat;
                                    
                                    const activeClasses = cat === "All" 
                                        ? "bg-slate-800 text-white border-slate-800 shadow-md"
                                        : `bg-${color}-500 text-white border-${color}-500 shadow-md shadow-${color}-200`;
                                        
                                    const inactiveClasses = cat === "All"
                                        ? "bg-white text-slate-500 border-slate-200 hover:bg-slate-50"
                                        : `bg-white text-${color}-600 border-${color}-200 hover:bg-${color}-50 hover:border-${color}-300`;

                                    return (
                                        <button
                                            key={cat}
                                            onClick={() => setActiveCategory(cat)}
                                            className={`px-3 py-1.5 rounded-md text-[11px] font-bold uppercase tracking-wider transition-all border ${
                                                isActive ? `${activeClasses} transform scale-105` : inactiveClasses
                                            }`}
                                        >
                                            {cat}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Content Grid */}
                        <div className="flex flex-col gap-3 pb-20">
                            {isLoading ? (
                                <div className="text-center py-20">
                                    <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                                    <p className="text-slate-400">Loading your library...</p>
                                </div>
                            ) : data.length === 0 ? (
                                <div className="text-center py-20 bg-white rounded-2xl border-2 border-dashed border-slate-200">
                                    <div className="text-slate-300 mb-4 flex justify-center"><Icons.File /></div>
                                    <h3 className="text-lg font-bold text-slate-700">Start your library</h3>
                                    <p className="text-sm text-slate-400 mt-1 max-w-md mx-auto">
                                        Entries you create or import will be safely stored in the cloud.
                                    </p>
                                </div>
                            ) : filteredData.length === 0 ? (
                                <div className="text-center py-16 text-slate-400 italic bg-slate-50 rounded-2xl border border-transparent">
                                    No matches found for "{searchTerm}"
                                </div>
                            ) : (
                                filteredData.map((item) => (
                                    <div 
                                        key={item.id}
                                        onClick={() => handleCopy(item.message)}
                                        className={`group bg-white rounded-xl border p-5 cursor-pointer hover:shadow-lg transition-all flex flex-col sm:flex-row gap-5 relative hover:border-indigo-300 ${
                                            editingId === item.id ? 'border-indigo-500 ring-2 ring-indigo-100' : 'border-slate-200'
                                        }`}
                                    >
                                        <div className="sm:w-1/3 flex flex-col sm:border-r border-slate-100 sm:pr-5 gap-2">
                                            <div className="flex items-start justify-between">
                                                {(() => {
                                                    const color = getCategoryColor(item.category);
                                                    return (
                                                        <span className={`text-[10px] font-black text-${color}-600 uppercase tracking-wider bg-${color}-50 px-2 py-1 rounded border border-${color}-100`}>
                                                            {item.category}
                                                        </span>
                                                    );
                                                })()}
                                            </div>
                                            <h3 className="font-bold text-slate-800 text-base leading-snug">{item.scenario}</h3>
                                        </div>
                                        
                                        <div className="sm:w-2/3 flex items-center pr-10 relative">
                                            <p className="text-slate-600 text-sm line-clamp-2 group-hover:text-slate-900 whitespace-pre-wrap leading-relaxed">
                                                {item.message}
                                            </p>
                                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-white/90 flex items-center justify-end opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none pr-0">
                                                <span className="text-xs font-bold text-indigo-600 flex items-center gap-1 bg-white px-2 py-1 rounded shadow-sm border border-indigo-100">
                                                    <Icons.Copy /> Click to Copy
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div className="absolute right-2 top-2 sm:top-1/2 sm:-translate-y-1/2 flex flex-col sm:flex-row items-center gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all bg-white/80 sm:bg-transparent backdrop-blur sm:backdrop-blur-none p-1 rounded-lg">
                                            <button 
                                                onClick={(e) => startEdit(item, e)} 
                                                title="Edit"
                                                className="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                                            >
                                                <Icons.Edit />
                                            </button>
                                            <button 
                                                onClick={(e) => deleteEntry(item.id, e)} 
                                                title="Delete"
                                                className="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                            >
                                                <Icons.Trash />
                                            </button>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </main>

                    {/* Toast Notification */}
                    {toast.show && (
                        <div className="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 toast-enter">
                            <div className="bg-slate-900/90 backdrop-blur text-white px-6 py-3.5 rounded-full shadow-2xl flex items-center gap-3 border border-slate-700/50">
                                <div className="text-emerald-400 bg-emerald-400/20 p-1 rounded-full"><Icons.Check /></div>
                                <span className="font-bold text-sm tracking-wide">{toast.message}</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
