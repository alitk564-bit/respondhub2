<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Segoe UI', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- SheetJS for Excel Parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Lucide Icons (via unpkg for reliability) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #f8fafc;
            -webkit-font-smoothing: antialiased;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { 
            Upload, Search, Check, Trash2, FileText, 
            Plus, Edit3, Download, Copy, LayoutGrid, X, Save
        } = lucide;

        const THEMES = [
            { id: 'blue', bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-700', icon: 'text-blue-500', shadow: 'shadow-blue-100', activeRing: 'ring-blue-500' },
            { id: 'violet', bg: 'bg-violet-50', border: 'border-violet-200', text: 'text-violet-700', icon: 'text-violet-500', shadow: 'shadow-violet-100', activeRing: 'ring-violet-500' },
            { id: 'emerald', bg: 'bg-emerald-50', border: 'border-emerald-200', text: 'text-emerald-700', icon: 'text-emerald-500', shadow: 'shadow-emerald-100', activeRing: 'ring-emerald-500' },
            { id: 'rose', bg: 'bg-rose-50', border: 'border-rose-200', text: 'text-rose-700', icon: 'text-rose-500', shadow: 'shadow-rose-100', activeRing: 'ring-rose-500' },
            { id: 'amber', bg: 'bg-amber-50', border: 'border-amber-200', text: 'text-amber-700', icon: 'text-amber-500', shadow: 'shadow-amber-100', activeRing: 'ring-amber-500' },
            { id: 'cyan', bg: 'bg-cyan-50', border: 'border-cyan-200', text: 'text-cyan-700', icon: 'text-cyan-500', shadow: 'shadow-cyan-100', activeRing: 'ring-cyan-500' },
            { id: 'fuchsia', bg: 'bg-fuchsia-50', border: 'border-fuchsia-200', text: 'text-fuchsia-700', icon: 'text-fuchsia-500', shadow: 'shadow-fuchsia-100', activeRing: 'ring-fuchsia-500' },
            { id: 'lime', bg: 'bg-lime-50', border: 'border-lime-200', text: 'text-lime-700', icon: 'text-lime-500', shadow: 'shadow-lime-100', activeRing: 'ring-lime-500' },
            { id: 'indigo', bg: 'bg-indigo-50', border: 'border-indigo-200', text: 'text-indigo-700', icon: 'text-indigo-500', shadow: 'shadow-indigo-100', activeRing: 'ring-indigo-500' },
            { id: 'orange', bg: 'bg-orange-50', border: 'border-orange-200', text: 'text-orange-700', icon: 'text-orange-500', shadow: 'shadow-orange-100', activeRing: 'ring-orange-500' },
        ];

        const App = () => {
            const [data, setData] = useState(() => {
                if (window.INITIAL_DATA) return window.INITIAL_DATA;
                const saved = localStorage.getItem('agent_helper_data');
                return saved ? JSON.parse(saved) : [];
            });
            const [searchTerm, setSearchTerm] = useState("");
            const [activeCategory, setActiveCategory] = useState("All");
            const [toast, setToast] = useState({ show: false, message: "" });
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formEntry, setFormEntry] = useState({ scenario: "", message: "", category: "", section: "" });
            
            const fileInputRef = useRef(null);

            useEffect(() => {
                lucide.createIcons();
            }, []);

            useEffect(() => {
                lucide.createIcons();
            }, [data, activeCategory, showForm, toast]); 

            const categoryData = useMemo(() => {
                const rawCats = ["All", ...new Set(data.map(i => i.category))];
                return rawCats.map((name, index) => ({
                    name,
                    theme: THEMES[index % THEMES.length]
                }));
            }, [data]);

            const activeTheme = useMemo(() => {
                return categoryData.find(c => c.name === activeCategory)?.theme || THEMES[0];
            }, [activeCategory, categoryData]);

            const saveData = (updated) => {
                setData(updated);
                localStorage.setItem('agent_helper_data', JSON.stringify(updated));
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();

                if (file.name.endsWith('.json')) {
                    reader.onload = (evt) => {
                        try {
                            const imported = JSON.parse(evt.target.result);
                            if (Array.isArray(imported)) {
                                saveData([...data, ...imported]);
                                showToast(`Restored ${imported.length} responses`, "success");
                            }
                        } catch (err) { showToast("Invalid backup file", "error"); }
                    };
                    reader.readAsText(file);
                    return;
                }

                reader.onload = (evt) => {
                    try {
                        const bstr = evt.target.result;
                        const wb = XLSX.read(bstr, { type: 'binary' });
                        let imported = [];
                        wb.SheetNames.forEach((sheetName) => {
                            const jsonData = XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);
                            const entries = jsonData.map((row, idx) => {
                                const keys = Object.keys(row);
                                const scenarioKey = keys.find(k => k.toLowerCase().includes('scenario')) || keys[0];
                                const messageKey = keys.find(k => k.toLowerCase().includes('message')) || keys[1];
                                const sectionKey = keys.find(k => k.toLowerCase().includes('section')) || null;
                                return {
                                    id: `xl-${sheetName}-${idx}-${Date.now()}`,
                                    scenario: String(row[scenarioKey] || "Untitled"),
                                    message: String(row[messageKey] || ""),
                                    section: sectionKey ? String(row[sectionKey]) : "",
                                    category: sheetName
                                };
                            }).filter(i => i.message);
                            imported = [...imported, ...entries];
                        });
                        saveData([...data, ...imported]);
                        showToast(`Imported ${imported.length} from Excel`, "success");
                    } catch (err) { showToast("Import failed", "error"); }
                };
                reader.readAsBinaryString(file);
            };

            const handleClearAll = () => {
                if(confirm("Are you sure you want to permanently remove ALL responses? This cannot be undone.")) {
                    setData([]);
                    localStorage.removeItem('agent_helper_data');
                    showToast("Library cleared", "success");
                }
            };

            const handleFormSubmit = (e) => {
                e.preventDefault();
                if (!formEntry.scenario || !formEntry.message || !formEntry.category) 
                    return showToast("Please fill all fields", "error");

                let updated;
                if (editingId) {
                    updated = data.map(i => i.id === editingId ? { ...formEntry, id: editingId } : i);
                    showToast("Response updated successfully", "success");
                } else {
                    updated = [{ ...formEntry, id: Date.now().toString() }, ...data];
                    showToast("New response added", "success");
                }
                saveData(updated);
                resetForm();
            };

            const resetForm = () => {
                setFormEntry({ scenario: "", message: "", category: "", section: "" });
                setEditingId(null);
                setShowForm(false);
            };

            const startEdit = (item, e) => {
                e.stopPropagation();
                setEditingId(item.id);
                setFormEntry({ 
                    scenario: item.scenario, 
                    message: item.message, 
                    category: item.category,
                    section: item.section || ""
                });
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const deleteEntry = (id, e) => {
                e.stopPropagation();
                if (confirm("Are you sure you want to delete this response?")) {
                    saveData(data.filter(i => i.id !== id));
                    showToast("Entry deleted", "success");
                }
            };

            const handleCopy = (text) => {
                if (editingId) return;
                navigator.clipboard.writeText(text).then(() => {
                    showToast("Copied to clipboard!", "success");
                }).catch(() => {
                    const el = document.createElement('textarea');
                    el.value = text;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);
                    showToast("Copied manually", "success");
                });
            };

            const showToast = (msg, type = "success") => {
                setToast({ show: true, message: msg, type });
                setTimeout(() => setToast({ show: false, message: "" }), 2500);
            };

            const filteredData = data.filter(item => {
                const matchSearch = item.scenario.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                    item.message.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    (item.section || "").toLowerCase().includes(searchTerm.toLowerCase());
                const matchCat = activeCategory === "All" || item.category === activeCategory;
                return matchSearch && matchCat;
            });

            const sections = useMemo(() => {
                const groups = {};
                const noSection = [];
                filteredData.forEach(item => {
                    if (item.section && item.section.trim() !== "") {
                        if (!groups[item.section]) groups[item.section] = [];
                        groups[item.section].push(item);
                    } else {
                        noSection.push(item);
                    }
                });
                const sortedSectionNames = Object.keys(groups).sort();
                return { groups, sortedSectionNames, noSection };
            }, [filteredData]);

            const renderCard = (item) => {
                const catObj = categoryData.find(c => c.name === item.category);
                const theme = catObj ? catObj.theme : THEMES[0];
                return (
                    <div 
                        key={item.id}
                        onClick={() => handleCopy(item.message)}
                        className={`group relative bg-white rounded-2xl p-6 cursor-pointer border border-transparent shadow-card hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col gap-4 overflow-hidden`}
                    >
                        <div className={`absolute top-0 bottom-0 left-0 w-1.5 ${theme.bg.replace('bg-', 'bg-gradient-to-b from-')}-400 to-${theme.id}-600`}></div>
                        <div className="pl-3 flex justify-between items-start">
                            <div className="space-y-1.5">
                                <div className="flex gap-2">
                                    <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[10px] font-black uppercase tracking-widest ${theme.bg} ${theme.text}`}>
                                        {item.category}
                                    </span>
                                    {item.section && (
                                        <span className="inline-flex items-center px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-widest bg-slate-100 text-slate-500">
                                            {item.section}
                                        </span>
                                    )}
                                </div>
                                <h3 className="font-bold text-slate-800 text-lg leading-tight group-hover:text-slate-900">{item.scenario}</h3>
                            </div>
                            <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200 translate-x-2 group-hover:translate-x-0">
                                <button onClick={(e) => startEdit(item, e)} className="p-2 text-slate-400 hover:text-slate-700 hover:bg-slate-100 rounded-lg transition-colors"><i data-lucide="edit-3" className="w-4 h-4"></i></button>
                                <button onClick={(e) => deleteEntry(item.id, e)} className="p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition-colors"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                            </div>
                        </div>
                        <div className="pl-3 flex-1">
                            <p className="text-slate-500 text-sm leading-relaxed line-clamp-4 whitespace-pre-wrap group-hover:text-slate-600 transition-colors font-medium">{item.message}</p>
                        </div>
                        <div className="pl-3 pt-4 mt-auto border-t border-slate-50 flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-slate-300">
                            <span className="group-hover:text-slate-400 transition-colors">Tap card to copy</span>
                            <div className={`p-1.5 rounded-lg transition-colors ${theme.bg} ${theme.text} opacity-0 group-hover:opacity-100`}>
                                <i data-lucide="copy" className="w-3.5 h-3.5"></i>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen pb-24 transition-colors duration-500">
                    <header className="fixed top-0 left-0 right-0 z-40 glass-panel border-b border-slate-200/50">
                        <div className="max-w-7xl mx-auto px-4 lg:px-8 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-slate-900 text-white p-2.5 rounded-xl shadow-lg shadow-slate-200"><i data-lucide="layout-grid" className="w-5 h-5"></i></div>
                                <div>
                                    <h1 className="font-bold text-slate-800 tracking-tight text-lg leading-none">Response Hub</h1>
                                    <p className="text-[10px] font-medium text-slate-400 uppercase tracking-widest mt-0.5">Agent Toolkit</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="hidden md:flex items-center gap-1 bg-slate-100/50 p-1 rounded-lg border border-slate-200/50">
                                    <button onClick={() => fileInputRef.current.click()} title="Import Data" className="p-2 text-slate-500 hover:text-slate-700 hover:bg-white rounded-md transition-all"><i data-lucide="upload" className="w-4 h-4"></i></button>
                                    <button onClick={handleClearAll} title="Clear All Data" className="p-2 text-slate-400 hover:text-rose-600 hover:bg-white rounded-md transition-all"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                </div>
                                <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".xlsx, .xls, .json" className="hidden" />
                                <button onClick={() => { resetForm(); setShowForm(!showForm); }} className={`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all shadow-md active:scale-95 ${showForm && !editingId ? 'bg-slate-200 text-slate-600' : 'bg-slate-900 text-white hover:bg-black hover:shadow-lg'}`}>
                                    <i data-lucide={showForm ? "x" : "plus"} className="w-4 h-4"></i>
                                    <span className="hidden sm:inline">{showForm ? 'Close' : 'New'}</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 lg:px-8 pt-24 pb-8 space-y-8">
                        <div className="flex flex-wrap gap-2.5 pb-2">
                            {categoryData.map((cat) => (
                                <button key={cat.name} onClick={() => setActiveCategory(cat.name)} className={`px-5 py-2.5 rounded-full text-xs font-bold uppercase tracking-widest transition-all border flex items-center gap-2 whitespace-nowrap ${activeCategory === cat.name ? `${cat.theme.bg} ${cat.theme.text} ${cat.theme.border} shadow-sm scale-105` : `bg-white border-slate-100 text-slate-400 hover:border-${cat.theme.id}-200 hover:text-${cat.theme.id}-600 hover:bg-slate-50`}`}>
                                    <span className={`w-1.5 h-1.5 rounded-full ${activeCategory === cat.name ? 'bg-current' : cat.theme.bg.replace('bg-', 'bg-') + '-400'}`}></span>
                                    {cat.name}
                                </button>
                            ))}
                        </div>

                        <div className="relative group">
                            <div className={`absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none transition-colors ${activeCategory !== 'All' ? activeTheme.text : 'text-slate-400'}`}><i data-lucide="search" className="w-5 h-5"></i></div>
                            <input type="text" className={`w-full pl-14 pr-12 py-5 rounded-2xl text-lg font-medium outline-none transition-all border bg-white shadow-soft focus:shadow-md ${activeCategory !== 'All' ? `focus:border-${activeTheme.id}-300 focus:ring-4 focus:ring-${activeTheme.id}-50 border-slate-200` : 'focus:border-slate-300 focus:ring-4 focus:ring-slate-100 border-slate-200'}`} placeholder={`Search through ${data.length} responses...`} value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                            {searchTerm && <button onClick={() => setSearchTerm('')} className="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-slate-600 transition-colors"><div className="bg-slate-100 p-1 rounded-full hover:bg-slate-200"><i data-lucide="x" className="w-4 h-4"></i></div></button>}
                        </div>

                        {showForm && (
                            <div className="bg-white border border-slate-200 rounded-3xl p-6 md:p-8 shadow-xl animate-fade-in relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-slate-200 via-slate-400 to-slate-200"></div>
                                <div className="flex justify-between items-center mb-8">
                                    <div><h2 className="text-xl font-bold text-slate-800">{editingId ? 'Edit Response' : 'Create New Response'}</h2><p className="text-sm text-slate-400">Fill in the details below to add to your library.</p></div>
                                    <button onClick={resetForm} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 transition-colors"><i data-lucide="x" className="w-6 h-6"></i></button>
                                </div>
                                <form onSubmit={handleFormSubmit} className="space-y-6">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Category</label>
                                            <input list="cat-list" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-medium focus:bg-white focus:border-slate-400 focus:ring-4 focus:ring-slate-100 outline-none transition-all" placeholder="e.g. Sales" value={formEntry.category} onChange={e => setFormEntry({...formEntry, category: e.target.value})} />
                                            <datalist id="cat-list">{categoryData.filter(c => c.name !== 'All').map(c => <option key={c.name} value={c.name} />)}</datalist>
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Section (Optional)</label>
                                            <input className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-medium focus:bg-white focus:border-slate-400 focus:ring-4 focus:ring-slate-100 outline-none transition-all" placeholder="e.g. Objections" value={formEntry.section} onChange={e => setFormEntry({...formEntry, section: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Scenario Title</label>
                                            <input className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-medium focus:bg-white focus:border-slate-400 focus:ring-4 focus:ring-slate-100 outline-none transition-all" placeholder="e.g. Price too high" value={formEntry.scenario} onChange={e => setFormEntry({...formEntry, scenario: e.target.value})} />
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Response Message</label>
                                        <textarea rows="5" className="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3.5 text-sm font-medium focus:bg-white focus:border-slate-400 focus:ring-4 focus:ring-slate-100 outline-none transition-all resize-y" placeholder="Type message..." value={formEntry.message} onChange={e => setFormEntry({...formEntry, message: e.target.value})} />
                                    </div>
                                    <div className="flex justify-end gap-3 pt-4 border-t border-slate-100">
                                        <button type="button" onClick={resetForm} className="px-6 py-3 rounded-xl font-bold text-sm text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-colors">Cancel</button>
                                        <button type="submit" className="px-8 py-3 bg-slate-900 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-black hover:shadow-xl active:scale-95 transition-all">{editingId ? 'Save Changes' : 'Add Response'}</button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="space-y-12">
                            {sections.noSection.length > 0 && (
                                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                    {sections.noSection.map(item => renderCard(item))}
                                </div>
                            )}
                            {sections.sortedSectionNames.map(sectionName => (
                                <div key={sectionName} className="space-y-4">
                                    <div className="flex items-center gap-4">
                                        <h3 className="text-sm font-black text-slate-400 uppercase tracking-widest whitespace-nowrap">{sectionName}</h3>
                                        <div className="h-px bg-slate-200 w-full"></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                        {sections.groups[sectionName].map(item => renderCard(item))}
                                    </div>
                                </div>
                            ))}
                            {data.length === 0 && (
                                <div className="py-32 text-center max-w-md mx-auto">
                                    <div className="inline-flex p-6 bg-slate-100 rounded-3xl text-slate-300 mb-6 animate-bounce"><i data-lucide="file-text" className="w-12 h-12"></i></div>
                                    <h3 className="text-2xl font-bold text-slate-800 mb-2">Library empty</h3>
                                    <div className="flex flex-col sm:flex-row gap-3 justify-center">
                                        <button onClick={() => setShowForm(true)} className="px-6 py-3 bg-slate-900 text-white rounded-xl font-bold text-sm shadow-lg hover:bg-black transition-all">Create New</button>
                                        <button onClick={() => fileInputRef.current.click()} className="px-6 py-3 bg-white text-slate-600 border border-slate-200 rounded-xl font-bold text-sm hover:bg-slate-50 transition-all">Import File</button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>

                    {toast.show && (
                        <div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-50 toast-enter">
                            <div className="bg-slate-900/90 backdrop-blur-md text-white px-6 py-3.5 rounded-2xl shadow-2xl flex items-center gap-3 border border-slate-700/50">
                                <div className={`p-1 rounded-full ${toast.type === 'error' ? 'bg-rose-500/20 text-rose-400' : 'bg-emerald-500/20 text-emerald-400'}`}><i data-lucide={toast.type === 'error' ? 'alert-circle' : 'check'} className="w-4 h-4"></i></div>
                                <span className="font-bold text-xs uppercase tracking-wider">{toast.message}</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
